Validation of a Digital Twin for a Ship
Engine Cooling System
Joachim Hammarström

Master’s thesis in Process and Systems Engineering
Supervisors: Jari Böling, Mikael Manngård and Jerker Björkqvist
Process Control Laboratory
Faculty of Science and Engineering
Åbo Akademi University
Turku, Finland, 2020

Joachim Hammarström

i

Acknowledgements
I would like to thank Jerker Björkqvist at Åbo Akademi University and Farbod Raubetean at Meyer
Turku for the opportunity to write this thesis.
I would like to thank Mikael Manngård at Åbo Akademi University for helping me model the engine
cooling system and coming with ideas for the thesis. I am also grateful for all his feedback during the
thesis process.
I would also like to thank Jari Böling at Åbo Akademi University for helping me with the engine cooling
system and Wilhelm Gustafsson at Meyer Turku for helping me when I had questions about the ship
data.
I would also like to thank my family for supporting me.
Turku, April 2020
Joachim Hammarström

Joachim Hammarström

ii

Abstract
The energy efficiency of ships is becoming more and more important due to increasingly stringent
international maritime regulations and rising fuel cost. While many methods have already been put in
use that increases the efficiency of some parts of the ship’s energy system, the whole power plant has
not received much attention.
In this thesis, data taken from a ship was used to modify and adapt a model of a ship engine cooling
system made in Simulink which was then validated.
The results show that even with relatively limited data and a quite simple model, it is possible to
simulate the cooling system of a ship’s engine quite well. Of the three available temperature
measurements, the model was reliably able to simulate two of them while the third had a few issues.
Key words: engine cooling system, dynamic simulation, cruise ship, Simulink, Matlab

Joachim Hammarström

Abbreviations
DG1

Diesel Generator 1 or Main Engine 1

DG3

Diesel Generator 3 or Main Engine 3

GT

Gross tonnage, a nonlinear way to measure the internal volume of a ship

HFSO

High sulphur fuel oil, maximum 3.50 mass-% sulphur

LNG

Liquefied natural gas

MGO

Marine gas oil

SOx

Sulphur oxides

ULSFO

Ultra low sulphur fuel oil, maximum 0.10 mass-% sulphur

VLSFO

Very low sulphur fuel oil, maximum 0.50 mass-% sulphur

iii

Joachim Hammarström

iv

Contents
Acknowledgements .............................................................................................................................i
Abstract .............................................................................................................................................. ii
Abbreviations .................................................................................................................................... iii
Contents ............................................................................................................................................ iv
1

2

3

Introduction ................................................................................................................................1
1.1

The ship ...............................................................................................................................2

1.2

Delimitation ........................................................................................................................2

Literature review.........................................................................................................................3
2.1

Digital twins.........................................................................................................................3

2.2

History of the digital twin ....................................................................................................3

Heat exchanger theory ................................................................................................................5
3.1

3.1.1

Shell and tube ..............................................................................................................5

3.1.2

Plate ............................................................................................................................6

3.1.3

Double-pipe heat exchanger ........................................................................................7

3.2

Parallel-flow.................................................................................................................8

3.2.2

Counter-flow................................................................................................................8

3.2.3

Cross-flow....................................................................................................................9

Heat exchanger simulation ..................................................................................................9

3.3.1

Heat exchange cell ..................................................................................................... 11

3.3.2

Driving forces............................................................................................................. 14

3.3.3

Determining the minimum number of cells ................................................................ 14

3.3.4

Adapting the heat exchanger model to design specifications ..................................... 17

Cooling water systems .............................................................................................................. 20
4.1

Freshwater cooling systems ............................................................................................... 20

4.1.1

HT circuit ................................................................................................................... 20

4.1.2

LT circuit .................................................................................................................... 20

4.2
5

Types of heat exchanger flow arrangements ........................................................................7

3.2.1

3.3

4

Types of heat exchanger construction .................................................................................5

Seawater cooling system ................................................................................................... 21

Control system .......................................................................................................................... 22
5.1

3-way valves ...................................................................................................................... 22

5.1.1

Temperature control valve for heat recovery ............................................................. 22

5.1.2

Temperature control valve for central cooler ............................................................. 23

5.1.3

Temperature control valve for the second stage of the charge air cooler ................... 23

Joachim Hammarström

6

v

5.1.4

Temperature control valve for lube oil cooler ............................................................ 23

5.1.5

Temperature control valve for HT water at the engine outlet ..................................... 23

5.1.6

WHR valve ................................................................................................................. 23

Simulation tool .......................................................................................................................... 24
6.1

7

Simulink............................................................................................................................. 24

Navigating large datasets .......................................................................................................... 25
7.1

Description of the data ...................................................................................................... 25

7.2

Sorting out data ................................................................................................................. 25

8

Digital twin................................................................................................................................ 27
8.1

Initial model of the engine cooling system ......................................................................... 27

8.2

Adapting the model ........................................................................................................... 27

8.2.1

Updating parameters ................................................................................................. 27

8.2.2

Adding real data as inputs .......................................................................................... 28

8.2.3

Sensor location .......................................................................................................... 30

8.2.4

Updating heat exchangers and tuning them ............................................................... 33

8.2.5

Updating setpoints..................................................................................................... 34

8.3
9

Problems with the LT circuit simulation ............................................................................. 38

Validation.................................................................................................................................. 40
9.1

Validation results............................................................................................................... 40

9.2

Conclusion of validation..................................................................................................... 50

10

Conclusion............................................................................................................................. 51

Summary in Swedish – Svensk sammanfattning ................................................................................ 52
References........................................................................................................................................ 56
Figures .............................................................................................................................................. 59
Tables ............................................................................................................................................... 61
APPENDICES...................................................................................................................................... 62

Joachim Hammarström

1

1 Introduction
Energy efficiency is becoming more and more important for ship owners, builders, and researchers
due to both increasingly strict international maritime regulations and rising fuel cost. All ships over 400
GT built after 1 January 2013 have to follow the new Energy Efficiency Design Index (EEDI) enforced by
the International Maritime Organization (IMO) to lower CO2 emissions by reducing fuel consumption.
The EEDI will become stricter every five years beginning in 2015, which means continuous
development is required to keep up with the regulations. This makes new ships more expensive to
build, but it is expected that the fuel savings will make up for the extra investment cost (IMO, n.da.;
ICCT, 2011).
On 1 January 2020, the emission limit for SOx and particulate matter was drastically reduced outside
of Sulphur Emission Control Areas (SECA), from 3.50 mass-% to 0.50 mass-%. Inside of SECAs, the limit
has been 0.10 mass-% since 1 January 2015 (IMO, n.db.). This forces ship operators to either install
exhaust gas scrubbers or buy fuel with lower sulphur content. Ships with exhaust gas scrubbers
installed can continue to use cheap fuel with high sulphur content (HFSO). Other ships will have to use
more expensive fuel oils such as VLSFO or ULSFO, or distillates such as MGO, which is even more
expensive, to meet the new regulations. Ships with gas engines or dual-fuel engines in gas mode
already conform to regulations since LNG does not contain sulphur. The fuel price increase caused by
this regulation is another reason why the maritime industry is focusing more and more on energy
efficiency.
According to (Zou, et al., 2013), there are many different methods by which fuel efficiency can be
improved. Some examples are weather routing, speed optimisation and efficient operation. The most
important role in the fuel energy utilisation is of course played by the marine engine itself, since it is
the heart of the power plant of the ship. Many methods have already been put into use to improve
the energy efficiency of the engine, for example, direct fuel injection, turbocharging, waste heat
recovery, etc. These methods, however, are primarily focused on some specific parts while the whole
power plant of the ship has not received much attention.
The goal of this thesis is to try and remedy that by adapting and then validating a simple digital twin of
a cruise ship’s engine cooling system to data obtained from that particular ship. Another goal is to
provide insight into what data is needed to run a dynamic simulation of the model, since the provided
model only uses static inputs. As heat exchangers are a key component of the cooling system, the
primary focus is put on simulating them.

Joachim Hammarström

2

This digital twin can then be used to see how the cooling system reacts to changes in setpoints,
parameters, flows, etc. In the future, digital twins will be used on ships in real time to try and optimise
the operation of the entire power plant (Manngård, et al., 2020).

1.1 The ship
The ship from which the data was taken is a modern, medium-sized cruise ship. It has two pairs of
large, medium-speed diesel engines with different cylinder counts. The ship is referred to as the
“reference ship” in the thesis.

1.2 Delimitation
Due to the engine cooling system being very dependent on preheating using the waste heat recovery
system when the engine is not running, it was decided to focus on simulating the cooling system during
operation. Thus, the results during the time periods when the engine is not running are mostly ignored
in this thesis.

Joachim Hammarström

3

2 Literature review
2.1 Digital twins
A digital twin is a virtual copy of a physical process, system, or product. It is constructed to act as a
bridge between the physical and the digital world. Using real-world measurements gathered by
sensors from a physical system, a digital copy of the system can be built. This model can then be used
to, for example, analyse or optimise the real system (Monteith, 2019; Shaw & Fruhlinger, 2019).

2.2 History of the digital twin
While the common belief is that the phrase “digital twin” was first mentioned by the actor Alan Alda
in 1998 when referring to a digital copy of his voice in Alan Alda meets Alan Alda 2.0 (Miskinis, 2019),
it had actually been used several times before. For example, in (Glos, 1997) it refers to a digital copy
of a book that highlighted traces, such as notes and coffee stains, that could then through manipulation
be seen on another physical version of the same book. In (Hernández & Hernández, 1997) it refers to
a model of a building project where changes were made on the project based on the results of the
building of its digital model. The changes were applied to the digital version, then checked, then
applied to the construction and so on. This is quite close to the modern usage of the term “digital
twin”.
The concept of having a copy of an object or system, albeit physical due to the technology at the time,
has been practised since the 1960s. A physical copy of Apollo 13 played a key role in the rescue mission
of the real Apollo 13 in April 1970, since it allowed engineers on the ground to test possible solutions
to the issues the crew faced (Miskinis, 2019).
The modern concept of a digital equivalent of a physical product was introduced by Dr. Michael Grieves
in 2002 during a course on Product Lifecycle Management (PLM) (Grieves & Vickers, 2017). Figure 1
shows the slide used in the presentation.

Joachim Hammarström

4

Figure 1 Conceptual ideal for PLM (Grieves & Vickers, 2017)

While it was not called a digital twin at the time, it had all the elements of one: physical model, virtual
model and a link for data to flow between the models. In the mid-2000s, it was referred to as the
Mirrored Spaces Model and Information Mirroring Model according to (Grieves & Vickers, 2017). In
(Grieves, 2011) the concept, while still called Information Mirroring Model, was expanded and the
term, Digital Twin, was attached to it. This was done in reference to the way John Vickers, who was
Grieves co-author, described the model, although NASA had already called it Digital Twin in 2010
(Shafto, et al., 2010; Piascik, et al., 2010).
During the next few years, there was not much interest in digital twins. (Google Trends, 2019) and
(Google Scholar, 2019) show that there were only a few searches and mentions until 2016. However,
it was not until 2017 that the interest really started to show. Figure 2 shows the large increase in
number of articles that feature “digital twin” in the title in the last few years. While not shown, the
relative number of searches according to Google Trends is very similar.

Number of articles with "digital twin" in
the title

Google Scholar - "digital twin" in titles
300
250
200
150
100

50
0
2011

2012

2013

2014

2015

2016

2017

2018

2019*

Figure 2 Number of articles on Google Scholar with "digital twin" in the title (Google Scholar, 2019)
*Until 27 September 2019 **Online pre-publication or journal with 2020 copyright

2020**

Joachim Hammarström

5

3 Heat exchanger theory
A ship engine cooling system can, for the most part, be considered a network of interconnected heat
exchangers. Hence, in this section, a brief review of the most common types of heat exchangers used
in industry is presented. To ensure that the heat exchanger models implemented in the digital twin are
able to capture both the steady-state and dynamical behaviour of the physical system, whilst having a
complexity suitable for realtime computations, a method of determining the appropriate model
complexity is proposed in Section 3.3.4.
A heat exchanger is a device that transfers heat between two or more fluids (liquid or gas) at different
temperatures. Due to the second law of thermodynamics, thermal energy always flows from the hot
fluid to the cold fluid unless external work is applied. In most heat exchangers, the fluids are separated
by some kind of wall. However, there are also heat exchangers where the fluids are in direct contact
with each other. Some typical applications for heat exchangers in the marine and energy industry are
heating or cooling a certain flow to a specific temperature, rejecting or recovering heat, or evaporation
or condensation of single- or multicomponent flows.
There are many different types of heat exchangers and these can be classified in different ways.
According to (Shah & Sekulić, 2003), heat exchangers can be classified according to construction
features, flow arrangements, transfer processes, number of fluids, degree of surface compactness, and
heat transfer mechanisms. The main methods of classification are construction features and flow
arrangements.

3.1 Types of heat exchanger construction
Even though there are many different types of heat exchangers, most of them fall into one of two
categories: shell and tube, or plate (U.S. Department of Energy, 1993). There is also a third type that is
relatively common among small companies due to it being simple and cheap, the double-pipe heat
exchanger (Nuclear Power, n.d.; STI, 2014).

3.1.1 Shell and tube
The shell and tube heat exchanger (Figure 3) is the most common heat exchanger in industrial
applications. It consists of a shell that contains a large number of tubes that are parallel to the shell.
One fluid flows through the tubes while the other flows between the tubes inside the shell allowing
heat transfer to take place. Baffles are usually installed in the shell to enhance heat transfer, since they
force the shell-side fluid to flow across the shell. A disadvantage of the shell and tube heat exchanger

Joachim Hammarström

6

is that it is relatively large and heavy, which means it is not suitable for automotive and aircraft
applications (Çengel & Ghajar, 2015).
Shell and tube heat exchangers can be further classified according to how many shell and tube passes
there are in the heat exchanger. Heat exchangers where the tubes make a U-turn in the shell are called
one-shell pass and two-tube pass heat exchangers. Similarly, if it has two shell passes and four tube
passes it is called a two-shell pass and four-tube pass heat exchanger (Çengel & Ghajar, 2015).

Figure 3 Shell and tube heat exchanger schematic (one-shell and one-tube pass) (Çengel &
Ghajar, 2015)

3.1.2 Plate
Another common type of heat exchanger is the plate (or plate and frame) heat exchanger (Figure 4).
It has plates instead of tubes to separate the fluids. The fluids alternate between each of the plates so
that every other gap has cold fluid flowing through while the rest have a flow of hot fluid. This means
that every stream of cold fluid is surrounded by two streams of hot fluid, which results in effective heat
transfer. The flow between plates is directed by baffles. Plate heat exchangers are usually smaller than
shell and tube heat exchangers of the same capacity due to the high heat transfer efficiency of the
plates (Çengel & Ghajar, 2015).

Figure 4 Plate and frame heat exchanger schematic (IPIECA, 2014)

Joachim Hammarström

7

3.1.3 Double-pipe heat exchanger
The simplest and most basic type of heat exchanger is the double-pipe heat exchanger (Figure
5). It consists of two concentric pipes that have different diameters. One fluid flows inside the

inner pipe, while the other flows through the annular space between both pipes (Çengel &
Ghajar, 2015). They are cheap to build, design and maintain which make them popular in small

companies. They are, however, not very efficient and require a large amount of space (STI,
2014).

Figure 5 Double pipe heat exchanger (Ramahlingam & Raghavan, 2011)

3.2 Types of heat exchanger flow arrangements
A common characteristic used to categorize heat exchangers is the direction of the two fluid flows
relative to each other. The four basic flow arrangements are counter-flow, parallel-flow, cross-flow
and hybrids such as cross/counter flow.

Joachim Hammarström

8

3.2.1 Parallel-flow
In parallel-flow (Figure 6) heat exchangers, both the shell fluid and the tube fluid flow parallel to each
other in the same direction. The output temperature of the cold flow will approach the output
temperature of the hot flow, but will never go higher (U.S. Department of Energy, 1993).

Figure 6 Parallel flow (Çengel & Ghajar, 2015)

3.2.2 Counter-flow
Counter-flow (Figure 7) heat exchangers are similar to parallel-flow heat exchangers, but instead of
the fluids flowing in the same direction, they flow in the opposite direction to each other. Since the
inlet of the hot fluid and the outlet of the same fluid are at the same end, the cooler fluid will approach
the inlet temperature of the hot fluid. This means that the cold fluid can reach a higher temperature
than the lowest temperature of the hot fluid. Due to this, the counter flow is the most efficient heat
exchanger if maximum temperature increase or decrease is desired (U.S. Department of Energy, 1993).

Figure 7 Counter flow (Çengel & Ghajar, 2015)

Joachim Hammarström

9

3.2.3 Cross-flow
In cross-flow (Figure 8) heat exchangers, the fluids flow perpendicular to each other. In other words,
the fluid in the shell flows around the flow in the tubes at a 90° angle. They are usually used in
applications where one of the fluids changes phase, for example a condenser where cooling water
flows through the tubes absorbing heat from the steam flowing around the tubes condensing it into
water (U.S. Department of Energy, 1993). Cross-flow heat exchangers can be either unmixed or mixed
depending on the configuration.

Figure 8 Cross flow a) Both fluids unmixed b) One fluid mixed, one fluid unmixed (Çengel & Ghajar,
2015)

3.3 Heat exchanger simulation
Modelling the dynamics of a heat exchanger can be done by using one of two general methods,
distributed and lumped. They have different features which make them ideal for different applications
(Varbanov, et al., 2011). The main features of the methods are compared in Table 1.

Joachim Hammarström

10

Table 1 Heat exchanger model type comparison (Varbanov, et al., 2011)

Property

Distributed model

Lumped model

Basic modelling element

Differential element

Heat exchange cell

Continuity

Continuous in both space and

Continuous in time and

time

discrete in space

Differential with regard to

Differential with regard to time

both space and time

only

Only two-stream heat

Perfect mixing is assumed in

exchangers are considered

the fluid compartments of

Differentiation

Simplifying assumptions

each modelling cell
Solution methods

The approaches used vary

Mostly direct numerical

from direct numerical

integration using finite

integration using finite

differences, approximating the

differences to hybrid methods

time derivatives. Note, that the

using analytical solutions of

physical space is already

the Laplace-transformed

explicitly discretised by

models and numerical

introducing the division of the

approximation of the reverse

exchanger into cells

Laplace transformation back
into the time domain
Note: Reprinted from “Cell-based dynamic heat exchanger models—Direct determination of the cell number
and size”, by Varbanov, et al., 2011, Computers & Chemical Engineering, 35, p. 945.

General assumptions for dynamic heat exchanger models
I.

Uniformly distributed heat transfer area throughout the heat exchanger.

II.

All thermal properties except the stream temperatures are considered constant.

III.

The heat conduction within the fluids and within the wall is considered negligible along the
direction of the flow.

IV.

The thermal resistance of the wall is neglected. This has the same effect as reducing the
overall heat transfer coefficient and can be compensated by increasing the individual heat
transfer coefficients.

V.

No heat is lost to the surroundings (Varbanov, et al., 2011).

The distributed models use equations that are derived from the general differential equations for
heat transfer in a material medium. The equations consider an infinitely small differential element of
the wall or the fluid stream. The result is a model that consists of a few partial differential equations

Joachim Hammarström

11

with differentiation with respect to time and a spatial coordinate, such as length or height (Varbanov,
et al., 2011).
Cell-based models are made by combining a number of perfectly mixed model tanks that are called
cells. If the number of cells is large enough, the simulation results will be equivalent to those of the
distributed model. Each heat exchange cell is expressed by two mass and three energy balances which
are ordinary differential equations with respect to time (Varbanov, et al., 2011).
Both methods have their own advantages and disadvantages and are therefore generally used for
different applications. Distributed models are usually preferred when investigating heat transfer
dynamics in general or studying a heat exchanger in detail, since they recognise the continuous nature
of the heat transfer, both in space and time. For studying complex heat exchangers or heat exchanger
networks, it is generally preferred to use cell-based models. While the number of equations can
become high, they are very simple and can be used for any type of heat exchanger. Another advantage
of the cell-based model is that the complexity can easily be scaled by adjusting the number of cells
(Varbanov, et al., 2011).

3.3.1 Heat exchange cell
Assumptions for cells
I.

Perfect mixing in both tanks in each heat exchanger cell.

II.

Constant fluid densities. This works well for liquids. For gases, this requires that the pressures
are kept almost constant.

III.

The tanks are completely filled with respective fluid.

IV.

Since the aim of the heat exchanger model is to control the fluid temperatures, the flows are
assumed to have constant specific heat capacities that are finite. This means that streams with
pure vaporisation or condensation are excluded.

V.

Due to the complex dynamics of heat transfer through the wall, the wall resistance to heat
transfer is not taken into consideration. The temperature of the wall can then be assumed to
be uniform within the cell volume. The heat capacity of the wall is, however, taken into account
since the metal heating and heat buffering might cause a delay in heat flow and therefore
influence the temperature distribution over time (Varbanov, et al., 2011).

Equations
In this section, the equations used in the heat exchangers are derived based on (Varbanov, et al., 2011),
(Çengel & Ghajar, 2015) and (Häggblom, 2015).

Joachim Hammarström

12

The mass balance of a tank in a cell is
𝑑𝑀TANK
= 𝑚̇in − 𝑚̇out ,
𝑑𝑡

(1)

where 𝑚̇in and 𝑚̇out are the mass flows of the fluid and 𝑀TANK is the mass of the fluid in the tank.
The energy balance is
𝑑𝐸TANK
= 𝐸̇in − 𝐸̇out ± 𝑄̇CELL ,
𝑑𝑡

(2)

where 𝐸̇in and 𝐸̇out are the energy flows in and out of the tank and 𝑄̇CELL is the heat transfer rate
through the wall of the tank. The heat is added for the cold side and subtracted for the hot side of the
tank.
The energy of a matter is proportional to its mass or mass flow and absolute temperature. This gives
the constitutive equations
𝐸 = 𝑐p 𝑇out 𝑀TANK ,

𝐸̇in = 𝑐p 𝑇in 𝑚̇in, ,

𝐸̇out = 𝑐p 𝑇out 𝑚̇out ,

(3)

where 𝑐p is the heat capacity of the fluid and 𝑇in and 𝑇out are the absolute temperatures of the fluid
at the inlet and outlet of the tank.
Due to assumptions (II), (III) and (IV) in the list above eliminating changes in mass flows, specific heat
capacity and fluid holdup, Equation (2) can now be written as
𝑀TANK 𝑐p

𝑑𝑇out
= 𝑚̇ 𝑐p 𝑇in − 𝑚̇ 𝑐p 𝑇out ± 𝑄̇CELL .
𝑑𝑡

(4)

The heat transfer rate of the hot and the cold tanks are given by
𝑄̇CELL,H = 𝐾H (𝑇H,out − 𝑇w ),

(5)

𝑄̇CELL,C = 𝐾C (𝑇w − 𝑇C,out ),

(6)

with 𝐾 = ℎ(𝑡)𝐴, where ℎ is the heat transfer coefficient and 𝐴 is the heat transfer area in a cell. 𝑇𝑤 is
the absolute temperature of the wall between the tanks.
Due to assumption (V), the energy balance of the wall is
𝑑𝐸w
= 𝑄̇CELL,H − 𝑄̇CELL,C .
𝑑𝑡

(7)

Using Equations (5) and (6), Equation (7) can be transformed into
𝑑𝐸w
= 𝐾H (𝑇H,out − 𝑇w ) − 𝐾C (𝑇w − 𝑇C,out ).
𝑑𝑡

(8)

Joachim Hammarström

13

Since the mass of the wall is clearly constant and by assuming the specific heat transfer is also constant,
Equation (8) can be rewritten as
𝑀Steel 𝑐p,Steel

𝑑𝑇w
= 𝐾H (𝑇H,out − 𝑇w ) − 𝐾C (𝑇w − 𝑇C,out ),
𝑑𝑡

(9)

where 𝑀Steel is the mass of the wall and 𝑐p,Steel is the specific heat capacity of the wall.
The heat transfer of a cell 𝑖 in the heat exchanger model is described by the following differential
equations transformed from Equations (4), (5), (6) and (9):
(𝑖)

𝑑𝑇H,out (𝑡)
𝑑𝑡

=

𝑚̇H (𝑡) (𝑖)
𝐾H
(𝑖)
(𝑖)
(𝑡) − 𝑇w(𝑖) (𝑡)),
(𝑇H,in (𝑡) − 𝑇H,out (𝑡)) −
(𝑇
𝑀H
𝑀H 𝑐p,H H,out

(10)

=

𝑚̇C (𝑡) (𝑖)
𝐾C
(𝑖)
(𝑖)
(𝑖)
(𝑇C,in (𝑡) − 𝑇C,out (𝑡)) +
(𝑇 (𝑡) − 𝑇C,out (𝑡)),
𝑀𝐶
𝑀C 𝑐p,C w

(11)

(𝑖)

𝑑𝑇C,out (𝑡)
𝑑𝑡
(𝑖)

𝑑𝑇w (𝑡)
𝐾H
𝐾C
(𝑖)
(𝑖)
(𝑖)
(𝑖)
=
(𝑇H,out (𝑡) − 𝑇w (𝑡)) −
(𝑇w (𝑡) − 𝑇C,out (𝑡)),
𝑑𝑡
𝑀Steel 𝑐p,Steel
𝑀Steel 𝑐p,Steel

(12)

where 𝑐p,C and 𝑐p,H are the specific heat capacities of the cold and hot side respectively. 𝑀H and 𝑀C
are the masses of the fluids at the hot and cold side.
If the wall is ignored, Equations (13)-(15) replace Equations (5), (6) and (10)-(12).
𝑄̇CELL = 𝐾(𝑇H,out − 𝑇C,out ),
(𝑖)

𝑑𝑇H,out (𝑡)
𝑑𝑡

=

𝑚̇H (𝑡) (𝑖)
𝐾
(𝑖)
(𝑖)
(𝑖)
(𝑡) − 𝑇C,out
(𝑡)),
(𝑇H,in (𝑡) − 𝑇H,out (𝑡)) −
(𝑇
𝑀H
𝑀H 𝑐p,H H,out

(14)

=

𝑚̇C (𝑡) (𝑖)
𝐾
(𝑖)
(𝑖)
(𝑖)
(𝑡) − 𝑇C,out
(𝑡)),
(𝑇C,in (𝑡) − 𝑇C,out (𝑡)) +
(𝑇
𝑀C
𝑀C 𝑐p,C H,out

(15)

(𝑖)

𝑑𝑇C,out (𝑡)
𝑑𝑡

(13)

Figure 9 shows how the heat exchanger in the model is constructed.

𝑚̇H (𝑡)

𝑚̇H (𝑡)

(𝑖)
𝑇H,𝑖𝑛 (𝑡)

𝑇H,out (𝑡)

𝑚̇C (𝑡)
(𝑖)

𝑇C,out (𝑡)

(𝑖)

𝑚̇H (𝑡)

Figure 9 Cell arrangement of a single-pass shell-and-tube heat exchanger (Varbanov, et al., 2011)

In Figure 10, a heat exchanger cell which includes the wall is shown.

(𝑖)

𝑇C,𝑖𝑛 (𝑡)

Joachim Hammarström

14

𝑇C,out

Cold

𝑄̇CELL,C

Wall

𝑄̇CELL,H

𝑇H,in

Hot

𝑇C,in

𝑇C,out
𝑇W
𝑇H,out

𝑇H,out

Figure 10 Heat exchanger cell including the wall

3.3.2 Driving forces
The driving force for heat transfer in heat exchangers is temperature difference. In the cell model, the
driving force is estimated using the temperature difference between the cells. This temperature
difference is smaller than the real temperature differences of the heat exchanger. This effect is strong
when the number of cells is small, but becomes weaker the more the number of cells increases. The
heat transfer coefficient in cell models has to compensate for this and is, therefore, larger than it would
be for an actual heat exchanger (Varbanov, et al., 2011) as shown in Figure 11. This is included in the
simulation by changing 𝐾 in Equations 10, 11 and 12 into 𝐾 = 𝑋ℎ𝐴 where 𝑋 is a positive number.

Figure 11 Driving forces are lower in the cell model

3.3.3 Determining the minimum number of cells
There are a number of ways to determine the minimum number of cells needed for adequate
simulation of a heat exchanger.
The specifications of one of the heat exchangers in the engine cooling system was made available for
use in the thesis. These values are listed in Table 2 and were used in the examples.

Joachim Hammarström

15

Table 2 Heat exchanger specification

Property

Cold flow

Hot flow

Specific heat capacity (J/(kg*K))

4190

4190

Mass flow (kg/s)

46.22

56.27

68

91

88.6

74.1

Inlet temperature (°C)
Desired outlet temperature (°C)

Graphical method in (Varbanov, et al., 2011)
If the number of cells is reduced below a certain number, the temperature differences become
negative, which would make the model thermodynamically incorrect. This creates a limiting case if
zero temperature difference is assumed in all cells of the heat exchanger. This was used by (Varbanov,
et al., 2011) to create a graphical method based on McCabe & Thiele’s (1925) method to determine
the number of stages needed to calculate a binary distillation column. This is drawn as a series of steps
that starts from one end of the heat exchanger as shown in Figure 12. The temperature curves are
straight lines drawn between respective inlet and outlet temperature.

Figure 12 Minimum number of cells based on the difference in temperature

It does not matter at which end of the heat exchanger the procedure is started, but in this example,
option 1 is used. First, a vertical line is drawn from the cold flow to the hot flow at the cold end of the
heat exchanger, then a horizontal line is drawn leftwards from that point until it reaches the cold flow,
which marks the end of the first cell. The same procedure is used to draw the rest of the cells until the
horizontal line exits at or above the cold water temperature at the hot end of the heat exchanger. In
this example, the minimum number of steps is four. This can also be done in the opposite direction
using option 2, which results in the same number of cells as option 1.

Joachim Hammarström

16

The method in Figure 12 works by assuming that the heat transfer coefficient of the cells is very large
(infinite). As a result of this, the cold temperature out of the cell will be the same as the hot
temperature into the cell, which means a straight line can be drawn. By then stepping as the method
proposes, the lower limit of the number of steps needed to be able to find a finite 𝐾 such that the
temperatures out of the heat exchanger is the same as in the specification can be found. An important
note is that this method does not say anything about how many cells that should be used, only the
minimum number of cells required to find a finite 𝐾.
Using the values in Table 2, this method was done in two slightly different ways using different graphs.
The left graph in Figure 13 approximates the temperature profile with straight lines like Varbanov,
while the right graph uses the method described in Section 3.3.4 with 𝑛 = 100. The result of both
versions is that a minimum of five cells is needed.

Figure 13 Left) Straight lines Right) Calculated curves

Simulink model
Another way to determine the minimum number of cells needed to simulate a heat exchanger is by
using simulation software, for example Simulink, which is the software used in this thesis. This was
done using two models, one model which included the wall while the other model ignored the wall.
The first one is based on Equations (10)-(12) while the other uses Equations (13) and (14). The following
procedure was used in the thesis:
Step 1.

Initialise the design parameters with one cell.

Step 2.

Set ℎ to a very large number.

Step 3.

Run the simulation.

Step 4.

If the simulated outlet temperature of the cold flow exceeds the desired temperature,
the minimum number of cells has been found. If not, increase the number of cells by
one and repeat from Step 3.

Joachim Hammarström

17

Using the values in Table 2, both versions required a minimum of five cells to fulfil the requirement of
Step 4.
Since all methods listed in this section give the same result, it can be concluded that the minimum
number of cells required for the heat exchanger in Table 2 is five.

3.3.4 Adapting the heat exchanger model to design specifications
In practice it would be useful to have a method for determining the cell heat transfer coefficient of the
model such that the outlet temperatures match the design specifications of the physical heat
exchanger. For this purpose, a steady-state analysis is sufficient.
The steady-state energy balances are obtained from Equations (13)-(15) by setting the derivatives to
(𝑖)

(𝑖)

zero. In this analysis the effect of the cell wall is ignored by assuming that 𝑇𝑤 (𝑡) = 𝑇𝐶,𝑜𝑢𝑡 (𝑡) as 𝑡 →
∞. For simplicity’s sake, the heat transfer is assumed to be 𝐾 = 𝐾C = 𝐾H . For the sake of notational
clarity, the steady-state outlet temperatures are denoted as 𝑇C (𝑖) and 𝑇H (𝑖) on the cold and hot sides
respectively for cells 𝑖 = 1,2, … , 𝑛. The steady-state relations are then given by the linear system of
equations
(𝑐𝑝,𝐶 𝑚̇𝐶 + 𝐾)𝑇𝐶 (1) − 𝐾𝑇𝐻 (𝑛) = 𝑐𝑝,𝐶 𝑚̇𝐶 𝑇𝐶,𝑖𝑛
(𝑐𝑝,𝐶 𝑚̇𝐶 + 𝐾)𝑇𝐶 (2) − 𝑐𝑝,𝐶 𝑚̇𝐶 𝑇𝐶 (1) − 𝐾𝑇𝐻 (𝑛 − 1) = 0
⋮
(𝑐𝑝,𝐶 𝑚̇𝐶 + 𝐾)𝑇𝐶 (𝑛) − 𝑐𝑝,𝐶 𝑚̇𝐶 𝑇𝐶 (𝑛 − 1) − 𝐾𝑇𝐻 (1) = 0
(16)
(𝑐𝑝,𝐻 𝑚̇𝐻 + 𝐾)𝑇𝐻 (1) − 𝐾𝑇𝐶 (𝑛) = 𝑐𝑝,𝐻 𝑚̇𝐻 𝑇𝐻,𝑖𝑛
(𝑐𝑝,𝐻 𝑚̇𝐻 + 𝐾)𝑇𝐻 (2) − 𝑐𝑝,𝐻 𝑚̇𝐻 𝑇𝐻 (1) − 𝐾𝑇𝐶 (𝑛 − 1) = 0
⋮
(𝑐𝑝,𝐻 𝑚̇𝐻 + 𝐾)𝑇𝐻 (𝑛) − 𝑐𝑝,𝐻 𝑚̇𝐻 𝑇𝐻 (𝑛 − 1) − 𝐾𝑇𝐶 (1) = 0.
Given the heat exchanger parameters, inlet temperatures and mass flows, equation system (16) can
be expressed in a matrix form
𝐴(𝐾)𝑥 = 𝑏,

(17)

where 𝐴(𝐾) is a 2𝑛-by-2𝑛 matrix that depends on the unknown variable 𝐾 and the heat exchanger
parameters The vector 𝑥 is defined as 𝑥 = [𝑇𝐶 (1) ⋯ 𝑇𝐶 (𝑛)
[𝑐𝑝,𝐶 𝑚̇𝐶 𝑇𝐶,𝑖𝑛

0

⋯ 𝑐𝑝,𝐻 𝑚̇𝐻 𝑇𝐻,𝑖𝑛

temperatures 𝑥 are given by

𝑇𝐻 (1) ⋯ 𝑇𝐻 (𝑛)]𝑇 and 𝑏 =

0 ⋯]𝑇 . Assuming that 𝐴(𝐾) is invertible for all 𝐾, the outlet

Joachim Hammarström

18
𝑥 = [𝐴(𝐾)]−1 𝑏.

Defining a vector 𝑦 = [𝑇𝐶,𝑜𝑢𝑡

(18)

𝑇𝐻,𝑜𝑢𝑡 ]𝑇 , where 𝑇𝐶,𝑜𝑢𝑡 and 𝑇𝐻,𝑜𝑢𝑡 are the desired outlet temperatures,

and a 2-by-2𝑛 matrix 𝐶 such that
𝑦 = 𝐶𝑥 = 𝐶[𝐴(𝐾)]−1 𝑏,

(19)

the parameter 𝐾 which results in the model that best fits the design specifications is obtained by
minimising the cost function
𝐽 (𝐾) = ‖𝑦 − 𝐶𝑥‖22 = ‖𝑦 − 𝐶[𝐴(𝐾)]−1 𝑏‖22 ,

(P1)

where ‖ ⋅ ‖2 denotes the ℓ2 vector norm. Although this is a non-convex problem with respect to 𝐾,
since the only unknown parameter is scalar, optimisation problem (P1) can either be solved by trialand-error or by using the unconstrained optimisation solver fminunc() in MATLAB. Note that for
a small number of cells 𝑛, the obtained 𝐾 might be very large and it would be advantageous to use a
larger 𝑛 than the minimum number of cells obtained by the graphical method presented in Section
3.3.3.
The proposed method can be summarised as follows:
Step 1.

Initialise the design parameters 𝑐𝑝,𝐶 , 𝑐𝑝,𝐻 , 𝑚̇𝐶 , 𝑚̇𝐻 , 𝑇𝐶,𝑖𝑛 , 𝑇𝐻,𝑖𝑛 , 𝑇𝐶,𝑜𝑢𝑡 , 𝑇𝐻,𝑜𝑢𝑡 according
to the heat exchanger specifications.

Step 2.

Determine the number of cells 𝑛 needed using the graphical method presented in
Section 3.3.3.

Step 3.

Solve optimisation problem P1 to obtain the needed 𝐾.

Step 4.

Divide 𝐾 by 𝐴⁄𝑛 to obtain the cell heat transfer coefficient ℎCELL . 𝑋 mentioned in
Section 3.3.2 can be obtained if ℎCELL is divided by ℎ.

Since this method was developed at a late stage of the project, after the adaption of the engine cooling
system, manual tuning using ℎ𝑋 was instead done directly in Simulink. Table 3 shows the 𝑋 values of
the manual adaption compared to the MATLAB code using ℎ in Table 2 and an assumed heat exchanger
area of 120 𝑚 2. The “no walls” difference is mostly due to slightly different optimisation objectives.
The MATLAB code minimises the temperature errors while the manual method tried to make the outlet
temperature of the cold flow reach the desired temperature.
The reason why the 𝑋 values when the wall is taken into account are twice as high as the values when
the wall is ignored can be explained by using Equations (5), (6), and (13). Since perfect mixing is
assumed (assumption (I) in Section 3.3.1), the water temperature in steady-state (in a cell) is 𝑇C,out at

Joachim Hammarström

19

the cold side and 𝑇H,out at the hot side and the wall temperature is 𝑇𝑊 =

𝑇H +𝑇C
2

. This can then be

combined with Equation (5) to describe the heat transfer rate from the hot side to the wall:
1
𝐾
𝑄̇CELL,H = 𝐾(𝑇H,out − 𝑇W ) = 𝐾 (𝑇H,out − (𝑇H,out + 𝑇C,out )) = (𝑇H,out − 𝑇C,out ),
2
2

(20)

and with Equation (6) to describe the heat transfer rate from the wall to the cold side:
1
𝐾
(21)
𝑄̇CELL,C = 𝐾(𝑇W − 𝑇C,out ) = 𝐾 ( (𝑇H,out + 𝑇C,out ) − 𝑇C,out ) = (𝑇H,out − 𝑇C,out ).
2
2
Since both equations result in a 𝑄̇ value that is half of that in Equation (13), it explains why the 𝑋 value
(or the cell heat transfer coefficient, ℎCELL ) when the wall is taken into account has to be twice that of
the value when the wall is ignored.
Table 3 Comparison between Simulink and MATLAB

Number of cells

𝑿 (Simulink (no walls)) 𝑿 (MATLAB (no walls)) 𝑿 (Simulink (walls))

5

19

17.7700

38

7

3.2

3.1546

6.4

8

2.53

2.5090

5.06

20

1.355

1.3483

2.71

32

1.215

1.2084

2.43

64

1.115

1.1122

2.23

While five cells are enough for the simulation, it was decided to use eight cells in the model. This was
done to have a margin of error during simulation.

Joachim Hammarström

20

4 Cooling water systems
4.1 Freshwater cooling systems
Large marine diesel engines are usually water-cooled, and so are all four engines in the reference ship.
About 25% of the chemical energy in the fuel is transformed into heat and has to be removed from the
engine. This is done by having a closed freshwater cooling system for each engine, which is split into
two separate circuits: a high-temperature (HT) and a low-temperature (LT) circuit. The freshwater
system is cooled in a central cooler using an open seawater cooling system. Figure 14 shows a
simplified version of the engine cooling system of one of the engines on the reference ship.

Lube oil
cooler
Seawater
cooler
Charge-air
coolers
HT Water

Waste heat
recovery HE

Jacket
LT Water

HT = High Temperature
LT = Low Temperature

Figure 14 Simplified engine cooling system (Manngård, 2019), modified by the author

4.1.1 HT circuit
The HT circuit is used to cool the cylinder liner, the cylinder head and the first stage of the charge air
cooler. The cooling water is pumped by an engine-driven pump mounted at the free end of the engine.
Since the engine is run at a constant speed, the HT water flow is constant. After the charge air cooler
the water flows to a thermostatic valve that controls how much is sent to the waste heat recovery
(WHR) heat exchanger respective circulated directly back into the engine. The HT water is cooled by
mixing with LT water using a valve.

4.1.2 LT circuit
The LT circuit cools the second stage of the charge air cooler and the lube oil cooler. The LT pump is
electrically driven with a constant flow rate. One of the tasks of the LT water is to cool charge air to a
constant temperature at the engine inlet. This is controlled by letting some of the flow bypass the
charge air cooler. The LT water is cooled with seawater in the central cooler.

Joachim Hammarström

21

4.2 Seawater cooling system
To get rid of excess heat energy from the freshwater circuits, an open seawater circuit is used to dump
heat into the sea. Seawater is pumped from the sea through the central cooler where heat from the
LT circuit is transferred to the seawater and then led back into the sea. The main method of controlling
the LT water temperature is by controlling the pump power. If the LT water is still too cold, a valve will
open to let some of the water bypass the cooler.

Joachim Hammarström

22

5 Control system
The initial model had a control system consisting of five PI controllers, one for each of the five valves
that are controlled by the automation system. This control system was updated when specifications of
the real control of the reference ship where made available.

5.1 3-way valves
3-way valves are used to control the temperature of a flow. This can be done with either mixing or
diverting valves. If placed at the supply (before the application), a diverting valve is used. If placed at
the return (after the application), a mixing valve is used. Diverting valves are usually more expensive
than mixing valves.
On the reference ship, all 3-way valves in the engine cooling system and the WHR system are mixing
valves except the one immediately after the HT charge air cooler. In the model, however, diverting
valves are used instead. This is due to how Simulink works. It uses signals instead of physical properties
like flow rate and temperature. This means that the flow has to be calculated before the heat
exchanger. Figure 15 shows the placement of the 3-way valves in the engine cooling system. The valves
are (1) heat recovery, (2) central cooler, (3) second stage of the charge air cooler, (4) lube oil cooler,
(5) HT water at engine outlet, and (6) WHR. T1-5 are temperature sensors and PI1-5 are PI-controllers.
Lube oil
cooler
4

PI5

Seawater
cooler

1

T1

Charge-air
coolers

PI1

5

3

PI4

6

PI3

T4

T5

HT Water
Jacket

Waste heat
recovery HE

2

PI2

T3

T2

HT = High Temperature
LT = Low Temperature

LT Water
Figure 15 Simplified engine cooling system with valves, sensors and PI-controllers (Manngård, 2019), modified by the author

5.1.1 Temperature control valve for heat recovery
Valve 1 is used to control the maximum temperature of the water that is mixed with HT water from
the engine outlet before the HT pump. The temperature is controlled using a mixing valve where HT
water and LT water is mixed to keep the HT temperature constant at a certain setpoint depending on
engine load (Engine manufacturer, 2019).

Joachim Hammarström

23

5.1.2 Temperature control valve for central cooler
Valve 2 controls the LT water temperature before the engine by letting some of the water bypass the
cooler. The valve is used only when the seawater pump is at its lowest speed and the LT water is still
too cold. The LT water temperature setpoint is variable and depends on engine load (Engine
manufacturer, 2019).

5.1.3 Temperature control valve for the second stage of the charge air cooler
Valve 3 controls the charge air temperature at the engine inlet by partially bypassing LT water. Thus, a
constant charge air temperature can be maintained at the inlet.

5.1.4 Temperature control valve for lube oil cooler
Valve 4 controls the lube oil temperature at the engine inlet by partially bypassing lube oil. This keeps
the lube oil temperature at the inlet constant.

5.1.5 Temperature control valve for HT water at the engine outlet
Valve 5 controls the HT water temperature at the engine outlet. This is used to keep the outlet
temperature at a certain setpoint depending on load and seawater temperature.

5.1.6 WHR valve
Valve 6 controls the flow to the WHR heat exchanger. It is manually controlled and is used only when
the WHR heat exchanger is undergoing maintenance by letting the flow fully bypass it. Under normal
conditions, it sends everything through the heat exchanger.

Joachim Hammarström

24

6 Simulation tool
Process simulation describes industrial processes by means of the application of first principles (e.g.
conservation laws and thermodynamics) and mathematics (e.g. differential equations). There are two
different types of process simulation, steady state and dynamic. The main difference between them
is that steady state assumes that variables are constant and does not consider the effects of time.
Dynamic simulation, by contrast, does consider the effects of time and assumes that the model is in a
state of change (da Silva, 2015). Dynamic simulation is the most suitable method for creating an engine
cooling system digital twin due to the ship and its surroundings being in a constant state of change.
There is a large variety of applications that require dynamic simulation software. Some software are
made for more specific applications while others are made for more general use. Some examples of
dynamic simulation software for more specialised use are Apros Thermal and FreeDyn. Apros Thermal
is specialised for thermal power plants while FreeDyn is designed for multibody dynamics (Fortum Heat
and Power, 2019; FreeDyn, 2019). Simulink and Xcos, by contrast, are more general tools (MathWorks,
2019; Scilab, 2019).

6.1 Simulink
Simulink is a system dynamics software. It was chosen for the modelling of the digital twin since it is a
standard tool used both in the industry and for research.

Joachim Hammarström

25

7 Navigating large datasets
The first part of the thesis work was to analyse and sort out data from a large dataset provided by the
shipyard as an Excel spreadsheet. A separate Excel spreadsheet with descriptions was also provided
which helped considerably when trying to determine what the sensors actually measured.

7.1 Description of the data
The data was taken from a modern cruise ship during 31 days in March/April 2018. The dataset
consisted of 566 sensors in total reported as one-minute averages, a total of 44 640 rows per column.

7.2 Sorting out data
The data was analysed to try and learn why certain things were happening on the reference ship during
those days. For example, plotting the seawater temperature showed that it was quite stable at 27 °C
for days before it suddenly started to drop with a relatively constant speed until it stabilised at about
15 °C at the end of the data. The seawater temperature also had strange intervals where the
temperature rose slowly until suddenly dropped. Figure 16 shows the seawater temperature during
the 31-day trip.

Figure 16 Seawater temperature

To solve this, the latitude and longitude coordinates were added to 3D Maps in Microsoft Excel so that
the itinerary of the reference ship could be determined. This showed that the cruise ship was in the
Caribbean during the first 17 days, then undertook a six-day crossing of the Atlantic heading northeast,
then spent six days in the Mediterranean Sea before starting to cross the Atlantic again, presumably

Joachim Hammarström

26

to the Caribbean. The intervals with increased temperature occur in the harbour since the used cooling
water heats up the seawater close to the sensor.
The 3D Map was also used to determine when the different engines are in use. For example, in port
only one of the two smaller engines is online at about 50% load. However, one of the larger engines is
almost always in use when not in port. This is the engine that was used as the base for the simulation
of the engine cooling system due to the larger amount of data relevant to the thesis.
Since the model in Chapter 8 only uses static inputs, the next step was to analyse the data to determine
which sensors were needed to run dynamic simulations of the engine cooling system and which ones
could be used to adapt and validate it. The sensors used for simulation input were found by checking
the initial model of the system and then trying to determine the signal name in the spreadsheet. The
five inputs that were found are listed in Table 4.
Table 4 Inputs used in the engine cooling simulation

Input
DG x power

Description
Power for Diesel Generator x

DG x compressor
intake air
temperature
Seawater
temperature
WHR flow rate

Air temperature at the turbo compressor
intake for Diesel Generator x

WHR temperature

Unit Notes
kW Changed to load in
simulation
°C

Seawater temperature

°C

Flow rate of the secondary flow through
the WHR heat exchanger

kg/s

Temperature of the secondary flow
through the WHR heat exchanger

°C

Rough estimation based
on the total flow rate
The sensor reports the
flow rate in m3/h
The closest sensor was
faulty, so the next one
further back was used

The sensors used for validation are T1, T2 and T5 shown in Figure 15. T1 is referred to as “LT Water”,
T2 as “HT Water In” and T5 as “HT Water Out” in the figures from now on.

Joachim Hammarström

27

8 Digital twin
8.1 Initial model of the engine cooling system
A basic model of the engine cooling system made by (Manngård, et al., 2019) was provided for use in
the thesis. This meant that focus could be put on adapting the model to data instead of creating a
model. Figure 17 shows the basic model.

Figure 17 Base version of the engine cooling system model

8.2 Adapting the model
The reference ship has four engines of the same cylinder bore, but different number of cylinders. This
meant that one engine could be the focus while adapting the model, whereas the rest could easily be
modified in the end using the first engine as the base. Engine number 1 (DG1) was chosen to be the
main focus since it was the engine most in use during the time the data was collected.

8.2.1 Updating parameters
The first step was to update parameters using the engine product guide and asking an employee at the
shipyard for information. Flow rates and temperatures in the base model were qualified guesses while
the setpoints for the temperature control valves (TCV) were taken from the product guide. The
setpoints will be discussed later. The following constant parameters were updated:
•

HT circuit flow rate

•

LT circuit flow rate

•

LO circuit flow rate

•

Amount of water in the WHR heat exchanger

Joachim Hammarström

28

The charge air flow rate and temperature, WHR flow rate and temperature and seawater temperature
were also changed, but were later made dynamic. A special case, the seawater flow rate, was also
changed to better match the flow rate at maximum load. This flow rate should be dynamic, but due to
the lack of pump information, a 3-way valve in the LT circuit handles the cooling power of the seawater
heat exchanger instead.

8.2.2 Adding real data as inputs
After the parameters were updated, the following step was to start making the model dynamic by
using sensor data provided by the shipyard. The first set of data to be added was the mechanical engine
power. At the same time, the energy distribution of the fuel energy was updated according to the
engine product guide, as shown in Figure 18 and Figure 19. This revision was later found to have a
problem and had to be updated again, which will be discussed later. The setpoints were also slightly
changed due to the data.

Figure 18 Base version of the energy distribution of the marine diesel engine

Joachim Hammarström

29

Figure 19 First revision of the energy distribution of the marine diesel engine

The next sensor data to be added was the charge air temperature at the turbine inlet and the seawater
temperature. Especially the seawater temperature had a large effect on the simulation results.
Comparing Figure 20 and Figure 21, it is clear that the seawater temperature is an important parameter
in the modelling of the system.

Joachim Hammarström

30

Figure 20 LT temperature after the seawater heat exchanger with a constant seawater temperature of 25 °C (data when the
engine is offline has been excluded)

Figure 21 LT temperature after the seawater heat exchanger with the seawater temperature taken from data (data when
the engine is offline has been excluded)

The next step was to make the charge air flow dynamic using data from the product guide and slightly
change the lookup table for the turbo compressor ratio. The WHR flow rate was also changed to use
data instead of a constant. This, however, is only a rough approximation using average flows that
depends on different factors due to the lack of flowmeters in the flows to the WHR heat exchangers.

8.2.3 Sensor location
Until this point, it was thought that the sensor for the HT temperature after the engine was placed
between the engine jacket and the second stage of the charge air cooler. This fit the data well although

Joachim Hammarström

31

the temperature after the charge air cooler seemed too high, as it reached about 100 °C. After looking
more closely at the engine product guide and consulting an employee at the shipyard, it was confirmed
that the sensor is actually placed after the charge air cooler.
This realisation caused some problems, since it meant the temperature after the charge air cooler that
was now reaching 100 °C was supposed to be several degrees lower. Figure 22 shows the large
temperature difference between data and simulation. The temperatures are very close at a few
intervals when the engine has a lower load, but mostly the difference is about 6 °C.

Figure 22 HT temperature after the charge air cooler (data when the engine is offline has been excluded)

This made it clear that too much heat was being transferred from the jacket to the HT water. However,
no logical reason could be found, since the energy distribution was thought to be correct. Instead,
work shifted to the heat exchangers, since simulations showed that a two-cell model was not enough
to simulate realistic temperatures. The WHR heat exchanger and the seawater heat exchanger were
the first to be changed to an eight-cell model. Some faulty parameters in the LO subsystem were also
changed to more closely match reality. After the modification, the simulation temperatures decreased
by about 2 °C (Figure 23). Compared to the data the difference was now about 4 °C.

Joachim Hammarström

32

Figure 23 HT temperature after the charge air cooler (data when the engine is offline has been excluded)

Next, an error with the energy distribution percentages was found; too much heat was added to the
HT circuit and the LT circuit. This was caused by having the heat from the charge air transferred to
respective circuit twice, both from the jacket or lube oil and the charge air coolers. As shown in Figure
24, this was changed so that the charge air heat does not enter the jacket or lube oil.

Figure 24 Second revision of the energy distribution of the marine diesel engine

Joachim Hammarström

33

Figure 25 shows that the simulation is now able to reach the real temperatures from the data. The next
step was now to change the remaining two-cell heat exchangers to eight-cell ones, tune all heat
exchangers and find the setpoints for the controllers. The WHR valve was also changed to let
everything flow through the WHR heat exchanger to match the real system.

Figure 25 HT temperature after the charge air cooler (data when the engine is offline has been excluded)

8.2.4 Updating heat exchangers and tuning them
First, the lube oil cooler and both charge air coolers were updated and then tuned using 100% load to
match the heat balance in the engine product guide. Then the seawater cooler was tuned so that the
LT temperature at its outlet matched data. As seen in Figure 26, this proved to be a problem, since no
matter what heat transfer coefficient was chosen only some intervals of the simulation matched data,
although it still follows the pattern of the data. It seemed to be a combination of high LT water
temperature at the inlet and high seawater temperature, but no clear cut off points could be found.
The temperature data used for the secondary side of the WHR heat exchanger could be the problem.
Due to the sensor closest to the WHR heat exchangers in the WHR-system being faulty, a sensor further
away was used instead. While most of the flow passes through that sensor, the temperature could still
be quite different closer to the WHR heat exchangers due to other flows in the WHR system.

Joachim Hammarström

34

Figure 26 LT water and seawater temperature (data when the engine is offline has been excluded)

8.2.5 Updating setpoints
It was then time to determine the different setpoints. The first temperature control valve setpoint to
be tuned was the temperature at the engine outlet. After a few simulation runs with different
setpoints, it became clear that there were two different setpoints depending on engine load. Both
setpoints were also 1 °C lower when the seawater temperature dropped under a certain level. Figure
27 shows that the simulation follows the data quite well, although there are some deviations,
especially in the time interval 260-275 h where the data seems to follow no certain setpoint at all. This
interval along with some others seemed to follow the engine load instead of a certain setpoint. There
are at least four possible reasons for that. One is that the setpoint is actually dynamic and uses, for
example, an interpolated lookup table depending on load. Another reason might be that the sensor
that controls the engine temperature is actually located between the jacket and the charge air cooler
instead of after the latter. The third is a combination of the first and second. The fourth possible reason
that was found later suggests that more heat is transferred from the charge air cooler and that there
is an additional setpoint. The last version seemed to be the simplest and most logical reason and was
introduced later in the process and is used in the final version of the model.

Joachim Hammarström

35

Figure 27 HT temperature after the charge air cooler (data when the engine is offline has been excluded)

The next valve to receive updated setpoints was the temperature control valve for heat recovery.
Looking at the data and doing some test runs it seemed like there were two different setpoints, one at
high loads and another at lower loads. Figure 28 shows how the simulation compares to the data. The
simulation does well for the most part, although there are some parts where the temperature is
between the setpoints. Comparing the load with the temperature suggests that the sensor uses an
interpolated lookup table. This is discussed later in the chapter.

Figure 28 HT temperature after the HT/LT mixing valve (data when the engine is offline has been excluded)

The temperature control valve for the central cooler was the last valve to be tuned. At first, it looked
like the larger engines only had one setpoint, but upon closer examination they had short periods of

Joachim Hammarström

36

low loads where the setpoint was different. This did not change much due to the short periods of low
load so the simulation still looks like in Figure 26.
To make the model more accurate, an equation for the wall temperature was added to the heat
exchanger models. As a result, all heat transfer coefficients had to be tuned again to fit the
measurements. Tuning the first stage of the charge air cooler led to the realisation that it had a
significant effect on the HT temperature out of the engine. It was quickly noticed that by increasing
the heat transfer coefficient the HT water temperature started to follow the measurements more
closely. One of the setpoints was changed and the point where the seawater temperature affected the
setpoint was also changed. The simulation now managed to partly simulate the strange interval at 260275 h in Figure 27, which led to the discovery of a possible third setpoint. A small change to the lookup
table for the compression ratio of the turbo compressor was made to better simulate that interval.
This also made the lookup table more realistic, but it is still a rough estimation and lacks dynamic
efficiency since the real table was not accessible.
The setpoints for the temperature control valve for heat recovery were now replaced with the lookup
table mentioned earlier. This relatively simple lookup table improved the accuracy of the intervals
where the real temperature was not stable.
Since air and liquid water have very different abilities to transfer heat, both flows of the charge air
coolers were changed to have different heat transfer coefficients. This required some tuning to adapt
the simulation to the measurements.
The following three figures compare the final version of the simulation with data from the reference
ship. Figure 29 shows the HT water temperature after the engine. The simulation seems to follow the
data well, but is smoother and the largest peaks are lower.

Joachim Hammarström

37

Figure 29 HT temperature after the charge air cooler (data when the engine is offline has been excluded)

Figure 30 presents the temperature of the HT water after the HT/LT mixing valve. The simulation
follows the real data very well, but is smoother and has smaller peaks. The smoothness is likely due to
the mixing of the HT and LT water being assumed to be perfect and therefore better than the real
system.

Figure 30 HT temperature after the HT/LT mixing valve (data when the engine is offline has been excluded)

Joachim Hammarström

38

Figure 31 shows the LT water temperature after the seawater cooler. The simulation follows the
temperature changes well, but the deviation from the measured value is quite high at some intervals.
The possible causes are discussed in the next section.

Figure 31 LT temperature after the seawater cooler (data when the engine is offline has been excluded)

8.3 Problems with the LT circuit simulation
While the simulation of the HT circuit works very well, there are some problems with the LT circuit that
are still unsolved. It appears to be a complex problem that might have multiple factors contributing to
it.
The main problem, which can be seen in Figure 31, is that the temperature deviation varies
considerably during the first 450 hours of the trip. During some intervals, the simulation is not able to
cool down the LT water enough, while in other intervals it cools it down too much. There are also
intervals during those 450 hours where it manages to match the data quite well. This means that
changing the heat transfer coefficient will not help, since it would just make the deviations change
place. Another problem is that the seawater pump data shows that the seawater flow rate is almost
constant during all those time intervals, which means the heat transfer coefficient cannot be made
dynamic depending on flow rate. The seawater temperature is also constant during the time period,
so the cooling ability should not change much. This means that there is too much heat in the LT water
before the seawater cooler.
The question is where the extra heat is coming from. The LT circuit has two direct heat sources and
three indirect sources. The direct sources are the second stage of the charge air cooler and the lube

Joachim Hammarström

39

oil cooler while the indirect sources are the engine jacket, the first stage of the charge air cooler and
the WHR heat exchanger.
The heat transferred from the lube oil cooler, the second stage of the charge air cooler, and the engine
jacket is relatively close to the values reported by the engine guide. The first stage of the charge air
cooler shows larger changes, but it seems to have only a minimal effect on the LT water temperature
via the charge air. The temperature of the HT water flow to the WHR heat exchanger is relatively stable,
as seen in Figure 30, and it does not correlate with the LT water temperature.
The measured temperature of the WHR flow, however, does follow the measured temperature of the
LT water flow after the seawater cooler quite well. Even though this temperature is from a sensor
further back, it appears to have a notable effect on the seawater temperature. Thus, if the real
temperature closer to the WHR heat exchanger is lower, it could perhaps explain the deviations in the
LT water temperature. However, simulations showed that the real WHR temperature would have to
be several degrees lower to be able to reach the measured LT temperatures. The heat exchangers in
the WHR system that do not affect the temperature of the sensor used in the simulation are not
capable of cooling the WHR flow enough to reach the temperature needed to reach the measured LT
temperature.
While it was possible to obtain a marginally better result using various methods to make the heat
transfer coefficient dynamic, it was decided to keep the coefficient static to keep it similar to the other
heat exchangers.

Joachim Hammarström

40

9 Validation
Validation is necessary to confirm the accuracy of the model. This is usually done by validating the
model against data that was not used when adapting the model, but that was not possible to do for
this thesis. Since the seawater temperature changed so much during the trip, the choice was made to
use the whole time period for the adaption. However, the fine-tuning of the intervals where the
temperature is not stable was done at a single interval. This means that the data used for the adaption
can still be used for the validation. Since the reference ship has two pairs of engines, the other engine
of the same size (DG3) is also used to validate the model using the same parameters.
While Simulink ran the simulation using flexible step sizes, it was configured to only output every 60
seconds to match the actual measurements. This gave 44 640 data points per signal to work with.

9.1 Validation results
The outputs from Simulink and the outputs from the real system were imported into MATLAB so they
could be analysed.
First, the data used for adaption is validated. Since the model does not properly simulate the system
during the times the engine was off, two sets of data will be used: the full dataset and a dataset that
ignores the data points when the engine was turned off.
Figure 32 shows the temperature error of both datasets. Most of the large errors occur when the
engine is offline, which is expected due to the delimitation chosen in the thesis. The large errors that
occur during operation usually happen during startup or shutdown. The exception is the LT water that
has been discussed earlier.

Joachim Hammarström

41

Figure 32 Error of simulation data compared to validation data

In Table 5, the mean and mean absolute errors are presented. The mean absolute errors when the
engine is online are very good. Even though the simulation of the LT water flow has problems during
quite a large part of the journey, it has a lower mean absolute error than the HT water before the
engine. This suggests that the HT water before the engine has much larger peaks than the LT water.
Table 5 Mean and mean absolute errors

Mean error (°C)

Mean absolute error (°C)

HT Water Out (full)

0.87

1.68

HT Water Out (engine on)

0.07

0.45

HT Water In (full)

-1.68

2.22

HT Water In (engine on)

-0.55

0.87

LT Water (full)

0.37

1.79

LT Water (engine on)

0.39

0.70

Joachim Hammarström

42

Figure 33, Figure 34 and Figure 35 show histograms of the error distributions. They have been
truncated to more clearly show the mean value. The complete histograms are shown in Appendix A.
Figure 33 shows the error distribution of the HT water temperature after the charge air cooler. While
there are quite many errors larger than 2 °C, these occur when the engine is offline. The vast majority
of the errors during operation are very small.

Figure 33 Histograms of the error for HT water temperature after the charge air cooler (truncated)

The error distribution of the HT water temperature after the HT/LT mixing valve is shown in Figure 34.
The majority of the large errors occur when the engine is not running. The errors during operation are
very small.

Joachim Hammarström

43

Figure 34 Histograms of the error for HT water temperature after the HT/LT mixing valve (truncated)

Figure 35 shows the error distribution of the LT water temperature. The full data set has quite many
large errors, both positive and negative, due to the wildly changing measured temperature when the
engine is turned off. During operation the simulation works better, but there are still relatively many
errors, mostly on the positive side due to the problems mentioned in Section 8.3.

Joachim Hammarström

44

Figure 35 Histograms of the error of the LT water temperature (truncated)

The data from the other engine of the same size, DG3, was also used to validate the model. Everything
in the model was kept the same, except the engine specific inputs. These were engine power and
charge air temperature.
The following three figures compare the simulation with the data from DG3. The HT water temperature
after the engine is shown in Figure 36. The simulation seems to follow the data well when the engine
is running, although the simulation temperatures are slightly too high.

Joachim Hammarström

45

Figure 36 HT temperature after the charge air cooler (data when the engine is offline has been excluded)

Figure 37 shows the HT water temperature after the HT/LT mixing valve. This also follows the data
well, but like the HT temperature after the charge air cooler, the simulation temperatures are slightly
too high during periods when the measured temperatures are not stable. Since the model was adapted
to DG1, this likely means that the setpoints are slightly different. This is what causes the difference in
the HT temperature after the charge air cooler. The simulation is smoother with smaller spikes.

Figure 37 HT temperature after the HT/LT mixing valve (data when the engine is offline has been excluded)

The LT water temperature after the seawater cooler is shown in Figure 38. Like DG1, the simulation
follows the temperature changes quite well, but the temperature difference is rather high.

Joachim Hammarström

46

Figure 38 LT water temperature after the seawater cooler (data when the engine is offline has been excluded)

Figure 39 shows the errors of DG3. The very large error in the beginning of the “HT Water Out” graphs
due to the starting value is not shown to emphasize the rest of the errors. As with DG1, most of the
errors occur when the engine is offline due to the delimitation set for the thesis. During operation, the
errors are generally very small for both HT temperatures. The large errors occur during start up and
shutdown, although the HT water temperature after the HT/LT mixing valve has some intervals were
the simulation temperature is several degrees lower than the measured temperature for a couple of
hours. These occur when the engine is running at a very low load. Some test simulations with higher
setpoints for low loads were run to try and solve the problem, but it was impossible. This might indicate
that the HT flow is lower when the engine is running at very low loads.

Joachim Hammarström

47

Figure 39 Error of simulation data compared to validation data

Table 6 shows the mean and mean absolute errors of the simulation of DG3. The mean absolute errors
of the full set of this engine are much larger than those of DG1, which is expected due to it being used
much less so the properly simulated time period is shorter and not being the one the parameters were
adapted for. This also applies to the errors when the engine is running. The shorter operation period
also make the large errors affect the mean much more.
Table 6 Mean and mean absolute errors

Mean error (°C)

Mean absolute error (°C)

HT Water Out (full)

-0.68

3.33

HT Water Out (engine on)

0.17

0.71

HT Water In (full)

-4.14

4.75

HT Water In (engine on)

-0.78

1.62

LT Water (full)

-0.39

3.32

LT Water (engine on)

1.13

1.37

Joachim Hammarström

48

Figure 40, Figure 41 and Figure 42 show histograms of the error distributions. They have been
truncated to more clearly show the middle part. The complete histograms are shown in Appendix B.
Figure 40 shows the error distribution of the HT water temperature after the charge air cooler. The
simulation of the full data set is quite a lot worse than for DG1, but this is mostly due to the engine not
being in use much. The errors during operation small, although they are a little larger than for DG1.
These seem to be caused by the slightly different setpoint lookup table of the HT water temperature
after the HT/LT mixing valve.

Figure 40 Histograms of the error for HT water temperature after the charge air cooler (truncated)

The error distribution of the HT water temperature after the HT/LT mixing valve is shown in Figure 41.
There are numerous large errors in the full data set due to the engine being offline most of the time.
The simulation during times when the engine is online is very good, though. The relatively large number
of errors between 0.52 and 1.37 occur during times when the setpoint is not stable at a certain
temperature. Since the model was adapted for DG1, the setpoint lookup table for this engine might be
slightly different and therefore causing the errors. The quite large number of large negative errors
occurs when the engine is started/stopped and when it is run on low loads.

Joachim Hammarström

49

Figure 41 Histograms of the error for HT water temperature after the HT/LT mixing valve (truncated)

Figure 42 shows the error distribution of the LT water temperature. The full data set has numerous
large errors, both positive and negative, due to the wildly changing measured temperature when the
engine is turned off. During operation the simulation works better, but there are still relatively many
errors, mostly on the positive side due to the problems mentioned in Section 8.3. These are quite
similar to those of DG1, but accentuated due to the much shorter operation period.

Joachim Hammarström

50

Figure 42 Histograms of the error of the LT water temperature (truncated)

The simulations were done using variable time steps. This usually resulted in about 125 000 iterations
for DG1 and about 105 000 for DG3. Running the simulations on a quad-core Intel i5-4570 takes about
four to five minutes, which is around 10 000 times faster than real time. This is, however, a simple
model of just one engine in isolation. Adding all four engines to a simplified version of the WHR system
resulted in a simulation speed of about 90 minutes, which is still about 500 times faster than real time.
A simulation of the four engines together took about 47 minutes.

9.2 Conclusion of validation
Naturally, the simulation results will never be completely accurate due to simplifications made to the
model. The mean absolute errors in Table 5 and Table 6 and the “engine on” histograms of Figure 33Figure 35 and Figure 40-Figure 42 confirm that the model is still quite accurate. Especially the HT
temperature simulations are accurate during engine operation.
The main reasons for the deviations are simplifications. For example, the preheating during standby is
not simulated and the flows are either constant or based on very rough approximations. This especially
affects the LT temperature.

Joachim Hammarström

51

10 Conclusion
In this thesis, the goal was to provide insight into what data is needed to run dynamic simulations of a
ship engine cooling system model and to adapt and validate said model.
Only five input sensors for the engine cooling system were found in the data, which was a small
problem. This meant that although the data was enough for quite accurate dynamic simulations, it was
not possible to test whether more data would have improved the accuracy or not.
The validation results of both HT temperatures are promising. They show that it is possible to simulate
the HT circuit well even with a relatively simple model and few inputs. It also proved to be possible to
run simulations of DG3 by just changing the engine specific input data, but keep all other parameters
the same as for DG1. The simulation results of DG3 were slightly less accurate, likely due to the shorter
operation time accentuating the errors during start up and shutdown rather than the model being less
accurate.
The simulation of the LT circuit is, however, not as accurate. While the simulated temperature does
follow the pattern of the measured data, there are relatively large deviations. Similar deviations
happen during the simulation of DG3. Various explanations to the issue are presented in Section 8.3,
but the problem appears to be complex and no solution was found.
With more data, it would be possible to expand this model. For example, by adding the WHR system
to the model it would be possible to properly simulate the engine cooling system during the time
periods when the engine is offline. Another example would be to simulate all four engines connected
to the WHR system. While it was already possible to simulate all engines connected to a simplified
version of the WHR system, an issue with the sensor measuring the WHR water temperature after the
cooling systems meant that it was not possible to validate it.

Joachim Hammarström

52

Summary in Swedish – Svensk sammanfattning
Validering av en digital tvilling för ett fartygsmotorkylsystem
Energieffektivitet blir hela tiden viktigare och viktigare för rederier, skeppsbyggare och forskare, både
på grund av striktare internationella marina krav och ökande bränslekostnader. Alla fartyg över 400 GT
byggda efter 1 januari 2013 måste följa ett energieffektivitetsindex (EEDI) genomdrivet av den
internationella sjöfartsorganisationen IMO (International Maritime Organization) för att sänka
koldioxidutsläppen genom att minska på bränsleförbrukningen. EEDI kommer att bli striktare vart
femte år med början 2015, vilket kräver kontinuerlig utveckling av fartygen för att möta kraven. Detta
gör nya fartyg dyrare att bygga, men man förväntar sig att bränslebesparingen kommer att
kompensera för de extra investeringskostnaderna (IMO, u.da.; ICCT, 2011).
Den 1 januari 2020 sänktes gränsen för SOx och luftburna partiklar kraftigt utanför
svavelkontrollområden (SECA), från 3,50 massprocent till 0,50 massprocent. Inom SECA har gränsen
varit 0,10 massprocent sedan 1 januari 2015 (IMO, u.db.). Det här tvingar rederierna att installera
skrubbrar eller byta till bränsle som innehåller mindre svavel. Fartyg med skrubber kan fortsätta
använda billigt högsvavligt bränsle, medan resten av fartygen måste byta till dyrare lågsvavligt bränsle
för att uppfylla utsläppskraven. De ökade bränslekostnaderna är en av orsakerna till att marinindustrin
fokuserar mer och mer på energieffektivitet.
Det finns många metoder som kan användas för att öka effektiviteten, men de flesta fokuserar på
endast en del av energisystemet. Målet med detta arbete är att försöka råda bot på detta genom att
anpassa och validera en enkel digital tvilling av ett fartygs motorkylningssystem på data från ett fartyg.
Eftersom motorerna i standby är starkt beroende av förvärmning via värmeåtervinningssystemet
beaktas enbart hur simuleringen fungerar då motorerna är igång.
En digital tvilling är en virtuell kopia av en fysisk process, system eller produkt. Den är konstruerad för
att agera som en bro mellan den fysiska och den digitala världen. Den digitala kopian, som byggts upp
genom att använda mätningar från ett system, kan användas för att t.ex. analysera eller optimera det
fysiska systemet (Monteith, 2019; Shaw & Fruhlinger, 2019).
Arbetet fokuserade på den viktigaste delen i ett kylningssystem, värmeväxlarna. En värmeväxlare är
en apparat som används för att överföra värme mellan två eller fler fluider (vätska eller gas) med olika
temperaturer. Enligt termodynamikens andra huvudsats flödar energin alltid från den varma fluiden
till den kalla fluiden. Några typiska applikationer för värmeväxlare inom energi- och marinindustrin är

Joachim Hammarström

53

uppvärmning eller nedkylning av ett visst flöde, värmeåtervinning eller evaporerering eller
kondensering av något flöde.
Fartyget vars data används i avhandlingen har fyra motorer i två par med samma cylinderdiameter,
men olika cylinderantal. Alla motorer har varsitt kylsystem, där bl.a. värmeväxlarnas storlek skiljer sig
mellan de två större och de två mindre mototerna, men upplägget är det samma. En
högtemperaturkrets som kyler cylinderfodret, topplocket och första steget i laddluftkylaren och en
lågtemperaturkrets som kyler smörjoljan och det andra steget i laddluftkylaren. En enkel version av
kylsystemet visas i Figur 14. Alla fyra kylsystem är kopplade till samma värmeåtervinningssystem via
värmeåtervinningsvärmeväxlarna (waste heat recovery HE i Figur 14). Högtemperaturkretsen kyls av
värmeåtervinningssystemet och lågtemperaturkretsen kyls i sin tur av havsvattnet.
I kylsystemet finns fem ventiler som styrs av regulatorer med hjälp av temperatursensorer och en som
styrs manuellt. Dessa visas i Figur 15 där ventilerna är 1-6, temperatursensorerna T1-5 och
regulatorerna P1-5.
Simulink användes som program för att simulera motorkylningsmodellen. Det valdes som
simuleringsprogram för avhandlingen eftersom det är ett standardverktyg som används både i
industrin och i högskolor.
Det första steget i arbetet var att gå igenom stora mängder sensordata från fartyget för att reda ut
vilka sensorer som behövdes för att kunna simulera modellen och vilka som behövdes för att kunna
anpassa och validera den. Fem sensorer ansågs vara relevanta för själva simuleringen: motoreffekt,
turbokompressorns

inloppstemperatur,

havsvattentemperaturen,

värmeåtervinningsvattnets

flödeshastighet och värmeåtervinningsvattnets temperatur. Det fanns dock vissa problem med de två
senare. Flödeshastighetssensorn rapporterar hela flödet, så en grov estimering baserat på det totala
flödet gjordes. Temperatursensorn i värmeåtervinningsvattnet som ligger närmast värmeväxlarna
kopplade till kylsystemen var felaktig, så en sensor längre bak användes istället. Temperatursensorerna
som användes för anpassning och validering är T1, T2 och T5 i Figur 15.
En enkel modell av kylsystemet med statiska insignaler gjord av Manngård, et al. (2019) användes som
bas för arbetet. Detta gjorde att fokus kunde läggas på att anpassa modellen istället för att bygga den.
Eftersom alla motorer hade samma cylinderdiameter kunde arbetet fokusera på en motor. Den som
valdes var motor nummer 1 (DG1), eftersom den hade högst användningsgrad.
Anpassningsarbetet började med att uppdatera parametrar i modellen med hjälp av motorns
produktguide, bland annat massflödena i både den varma och den kalla kretsen. Nästa steg var att
använda data från de ovannämnda sensorerna för att göra de statiska insignalerna dynamiska.

Joachim Hammarström

54

Laddluftflödet gjordes dynamiskt genom att kombinera data från produktguiden med
motorbelastningen.

Eftersom

turbokompressorns

kompression

och

värmeväxlarnas

värmekoefficienter var okända ändrades de kontinuerligt för att anpassa simuleringen till mätdata.
Sensorn som mäter varmvattentemperaturen efter motorn antogs först vara belägen mellan själva
motorn och laddluftkylaren, men den visade sig vara belägen efter laddluftkylaren. Detta orsakade ett
problem, eftersom simuleringstemperaturen var flera grader högre än mätdata. Problemet visade sig
vara energifördelningen i modellen, för mycket värme tillfördes båda kylkretsarna. Detta orsakades av
att värme från laddluftkylarna överfördes till kylkretsarna två gånger, både från motorn eller
smörjoljan och från själva laddluftkylarna. Efter att detta ändrades sjönk simuleringstemperaturen till
rätt nivå.
Slutskedet av anpassningen handlade till stor del om att fastställa börvärdena för regulatorerna genom
att jämföra simuleringen med data eftersom de verkliga värdena inte var tillgängliga. Eftersom
vattentemperaturen före motorn beror mycket på belastningen används en enkel uppslagstabell för
att göra börvärdet dynamiskt. Temperaturen efter motorn beror till stor del på laddlufttemperaturen
och klarar sig därmed med några få olika börvärden som beror på belastning och
havsvattentemperaturen. Temperaturen i lågtemperaturkretsen har två börvärden som beror på
belastningen.
Medan simuleringen av högtemperaturkretsen fungerar bra, fanns det vissa problem i
lågtemperaturkretsen. Problemet, som kan ses i Figur 31, är att det finns stora temperaturskillnader
jämfört med mätdata under de 450 första timmarna. Under vissa intervall klarar simuleringen inte av
att kyla ner flödet tillräckligt mycket, medan i andra kyls flödet ner för mycket. Detta betyder att
problemet inte går att lösa genom att ändra värmeöverföringskoefficienten, eftersom detta endast
leder till att felen flyttar på sig. Både havsvattenflödet och havsvattentemperaturen är så gott som
konstanta, vilket betyder att kylförmågan inte borde ändras. Det kommer alltså för mycket värme in i
kylsystemet, men ingen lösning på detta hittades.
Validering är nödvändigt för att kunna bekräfta modellens noggrannhet. Data från båda motorerna
med samma cylinderantal användes för valideringen av modellen.
Histogrammen för den första motorn ses i Figur 33-35 där ”engine on” är mest relevant, eftersom
arbetet fokuserade på tiden då motorerna körs. Simuleringen av båda temperaturerna i
högtemperaturkretsen är väldigt nära mätdata, medan temperaturen i lågtemperaturkretsen har
relativt stora fel på grund av det tidigare nämnda problemet.

Joachim Hammarström

55

Den andra motorn (DG3) simulerades genom att ändra motorspecifika input, medan resten hölls
samma som för DG1. Histogrammen visas i Figur 40-42. DG3 har lite större fel än DG1 i båda
kylkretsarna, men felen är fortsatt små i högtemperaturkretsen. Skillnaden orsakas främst av att
motorn används under ett färre antal timmar än DG1, vilket gör att felen vid t.ex. start och stopp,
förstärks, men det kan även vara att DG3 har små skillnader i t.ex. börvärden.
Valideringsresultaten för högtemperaturkretsen är lovande, de visar att det är möjligt att simulera
högtemperaturkretsen med en relativt enkel modell. Simuleringen av lågtemperaturkretsen var inte
lika bra, men det kan eventuellt lösas med mera data.
Med

tillgång

till

mera

data

kunde

modellen

utökas,

t.ex.

genom

att

lägga

till

värmeåtervinningssystemet och därmed kunna simulera kylsystemet även då motorn är avstängd eller
simulera alla fyra motorer samtidigt. Det senare var möjligt redan i denna avhandling, men eftersom
temperatursensorn efter värmeåtervinningsvärmeväxlarna inte fungerade, var det inte möjligt att
anpassa eller validera.

Joachim Hammarström

56

References
Barlas, Y., 1996. Formal aspects of model validity and validation in system dynamics. System
Dynamics Review, 12(3), pp. 183-210.
Çengel, Y. A. & Ghajar, A. J., 2015. Heat and Mass Transfer: Fundamentals and Applications. 5 ed.
New York, New York: McGraw-Hill Education.
da Silva, F. J., 2015. Dynamic Process Simulation: When do we really need it?. [Online]
Available at: http://processecology.com/articles/dynamic-process-simulation-when-do-we-reallyneed-it
[Accessed 16 August 2019].
Engine manufacturer, 2019. Engine product guide. s.l.:s.n.
Fortum Heat and Power, 2019. Apros Thermal. [Online]
Available at: https://www.fortum.com/sites/g/files/rkxjap146/files/documents/apros-thermaldatasheet.pdf
[Accessed 23 August 2019].
FreeDyn, 2019. FreeDyn. [Online]
Available at: http://www.freedyn.at/
[Accessed 23 August 2019].
Glos, J. W., 1997. Digital Augmentation of Keepsake Objects: A Place for Interaction of Memory,
Story, and Self. Cambridge, MA: Massachusetts Institute of Technology.
Google Scholar, 2019. Google Scholar search for "digital twin" in title. [Online]
Available at: https://scholar.google.com/
[Accessed 27 September 2019].
Google Trends, 2019. Google Trends search for "digital twin". [Online]
Available at: https://trends.google.com/trends/explore?date=all&q=%22digital%20twin%22
[Accessed 27 September 2019].
Grieves, M., 2011. Virtually perfect: Driving innovative and lean products through product. Cocoa
Beach, FL: Space Coast Press.
Grieves, M. & Vickers, J., 2017. Digital Twin: Mitigating Unpredictable, Undesirable Emergent
Behavior in Complex Systems. In: F. Kahlen, S. Flumerfelt & A. Alves, eds. Transdisciplinary
Perspectives on Complex Systems. Basel: Springer International Publishing, pp. 85-113.
Hernández, L. & Hernández, S., 1997. Application of digital 3D models on urban planning. WIT
Transactions on The Built Environment, Volume 33, p. 395.
Häggblom, K., 2015. Reglerteknik I Grundkurs. Turku: Department of Chemical Engineering.
ICCT, 2011. The Energy Efficiency Design Index (EEDI) for New Ships. [Online]
Available at: https://theicct.org/sites/default/files/publications/ICCTpolicyupdate15_EEDI_final.pdf
[Accessed 17 December 2019].
IMO, n.da. Energy Efficiency Measures. [Online]
Available at:
http://www.imo.org/en/OurWork/Environment/PollutionPrevention/AirPollution/Pages/Technical-

Joachim Hammarström

57

and-Operational-Measures.aspx
[Accessed 17 December 2019].
IMO, n.db. Sulphur oxides (SOx) and Particulate Matter (PM) – Regulation 14. [Online]
Available at:
http://www.imo.org/en/OurWork/Environment/PollutionPrevention/AirPollution/Pages/Sulphuroxides-(SOx)-%E2%80%93-Regulation-14.aspx
[Accessed 18 December 2019].
IPIECA, 2014. Heat Exchangers. [Online]
Available at: http://www.ipieca.org/resources/energy-efficiency-solutions/efficient-use-ofheat/heat-exchangers/
[Accessed 26 July 2019].
Manngård, M., 2019. Personal communication. Turku: s.n.
Manngård, M., Lund, W. & Björkqvist, J., 2019. On-ship data compression and cleansing using Digital
Twins, Integrated Energy Solutions to Smart And Green Shipping 2019 Edition, Espoo, 13 March, pp.
41-44. [Online]
Available at: https://www.vttresearch.com/sites/default/files/pdf/technology/2019/T354.pdf
[Accessed 3 March 2020]
Manngård, M., Lund, W. & Björkqvist, J., 2020. Using Digital Twin Technology to Ensure Data Quality
in Transport Systems, Proceedings of 8th Transport Research Arena TRA 2020, Helsinki, 27-30 April.
[Online]
Available at:
https://www.researchgate.net/publication/339875335_Using_Digital_Twin_Technology_to_Ensure_
Data_Quality_in_Transport_Systems
[Accessed 18 March 2020]
Mathisen, K. W., Morari, M. & Skogestad, S., 1994. Dynamic models for heat exchangers and heat
exchanger networks. Computers & Chemical Engineering, 18(Supplement 1), pp. S459-S463.
MathWorks, 2019. Simulink. [Online]
Available at: https://se.mathworks.com/products/simulink.html
[Accessed 26 August 2019].
McCabe, W. & Thiele, E., 1925. Graphical design of fractionating columns. Industrial and Engineering
Chemistry, 17(16), pp. 605-611.
Miskinis, C., 2019. The history and creation of the digital twin concept. [Online]
Available at: https://www.challenge.org/insights/digital-twin-history/
[Accessed 24 September 2019].
Monteith, M., 2019. What Is a Digital Twin?. [Online]
Available at: https://www.iotforall.com/what-is-digital-twin-technology/
[Accessed 24 September 2019].
Nuclear Power, n.d. Types of Heat Exchangers – Classification of Heat Exchangers. [Online]
Available at: https://www.nuclear-power.net/nuclear-engineering/heat-transfer/heatexchangers/types-of-heat-exchangers/
[Accessed 25 July 2019].

Joachim Hammarström

58

Piascik, B. et al., 2010. Technology Area 12: Materials, Structures, Mechanical Systems, and
Manufacturing Roadmap, Washington, DC: NASA.
Ramahlingam, T. & Raghavan, V. R., 2011. The Tube Side Heat Transfer Coefficient for Enhanced
Double Tube by Wilson Plot Analysis. Journal of Applied Sciences, 11(10), pp. 1725-1732.
Scilab, 2019. Xcos. [Online]
Available at: https://www.scilab.org/software/xcos
[Accessed 26 August 2019].
Shafto, M. et al., 2010. Technology Area 11: Modeling, Simulation, Information Technology &
Processing Roadmap, Washington, DC: NASA.
Shah, R. K. & Sekulić, D. P., 2003. Fundamentals of Heat Exchanger Design. Hoboken, New Jersey:
John Wiley & Sons, Inc.
Shaw, K. & Fruhlinger, J., 2019. What is a digital twin and why it's important to IoT. [Online]
Available at: https://www.networkworld.com/article/3280225/what-is-digital-twin-technology-andwhy-it-matters.html
[Accessed 24 September 2019].
STI, 2014. Industrial Heat Exchangers: Design, Construction Types, Service and Maintenance Needs.
[Online]
Available at: https://setxind.com/downstream/industrial-heat-exchangers-construction-typesservice-maintenance/
[Accessed 25 July 2019].
U.S. Department of Energy, 1993. DOE Fundamentals Handbook, Mechanical Science, Volume 1 of 2.
Washington D.C.: U.S. Department of Energy.
Varbanov, P. S., Klemeš, J. J. & Friedler, F., 2011. Cell-based dynamic heat exchanger models—Direct
determination of the cell number and size. Computers & Chemical Engineering, 35(5), pp. 943-948.
Zou, G. et al., 2013. Modeling ship energy flow with multi-domain simulation, 27th CIMAC World
Congress on Combustion Engines, Shanghai, 13-16 May. [Online]
Available at:
https://www.researchgate.net/publication/257938048_Modeling_ship_energy_flow_with_multidomain_simulation
[Accessed 17 December 2019]

Joachim Hammarström

59

Figures
Figure 1 Conceptual ideal for PLM (Grieves & Vickers, 2017) ...............................................................4
Figure 2 Number of articles on Google Scholar with "digital twin" in the title (Google Scholar, 2019) ..4
Figure 3 Shell and tube heat exchanger schematic (one-shell and one-tube pass) (Çengel & Ghajar,
2015) ..................................................................................................................................................6
Figure 4 Plate and frame heat exchanger schematic (IPIECA, 2014) .....................................................6
Figure 5 Double pipe heat exchanger (Ramahlingam & Raghavan, 2011).............................................7
Figure 6 Parallel flow (Çengel & Ghajar, 2015) .....................................................................................8
Figure 7 Counter flow (Çengel & Ghajar, 2015)....................................................................................8
Figure 8 Cross flow a) Both fluids unmixed b) One fluid mixed, one fluid unmixed (Çengel & Ghajar,
2015) ..................................................................................................................................................9
Figure 9 Cell arrangement of a single-pass shell-and-tube heat exchanger (Varbanov, et al., 2011) ... 13
Figure 10 Heat exchanger cell including the wall ............................................................................... 14
Figure 11 Driving forces are lower in the cell model .......................................................................... 14
Figure 12 Minimum number of cells based on the difference in temperature.................................... 15
Figure 13 Left) Straight lines Right) Calculated curves ....................................................................... 16
Figure 14 Simplified engine cooling system (Manngård, 2019), modified by the author ..................... 20
Figure 15 Simplified engine cooling system with valves, sensors and PI-controllers (Manngård, 2019),
modified by the author ..................................................................................................................... 22
Figure 16 Seawater temperature ...................................................................................................... 25
Figure 17 Base version of the engine cooling system model .............................................................. 27
Figure 18 Base version of the energy distribution of the marine diesel engine .................................. 28
Figure 19 First revision of the energy distribution of the marine diesel engine .................................. 29
Figure 20 LT temperature after the seawater heat exchanger with a constant seawater temperature
of 25 °C (data when the engine is offline has been excluded) ............................................................ 30
Figure 21 LT temperature after the seawater heat exchanger with the seawater temperature taken
from data (data when the engine is offline has been excluded) ......................................................... 30
Figure 22 HT temperature after the charge air cooler (data when the engine is offline has been
excluded) .......................................................................................................................................... 31
Figure 23 HT temperature after the charge air cooler (data when the engine is offline has been
excluded) .......................................................................................................................................... 32
Figure 24 Second revision of the energy distribution of the marine diesel engine.............................. 32
Figure 25 HT temperature after the charge air cooler (data when the engine is offline has been
excluded) .......................................................................................................................................... 33
Figure 26 LT water and seawater temperature (data when the engine is offline has been excluded) . 34
Figure 27 HT temperature after the charge air cooler (data when the engine is offline has been
excluded) .......................................................................................................................................... 35
Figure 28 HT temperature after the HT/LT mixing valve (data when the engine is offline has been
excluded) .......................................................................................................................................... 35
Figure 29 HT temperature after the charge air cooler (data when the engine is offline has been
excluded) .......................................................................................................................................... 37
Figure 30 HT temperature after the HT/LT mixing valve (data when the engine is offline has been
excluded) .......................................................................................................................................... 37
Figure 31 LT temperature after the seawater cooler (data when the engine is offline has been
excluded) .......................................................................................................................................... 38
Figure 32 Error of simulation data compared to validation data ........................................................ 41
Figure 33 Histograms of the error for HT water temperature after the charge air cooler (truncated) 42

Joachim Hammarström

60

Figure 34 Histograms of the error for HT water temperature after the HT/LT mixing valve (truncated)
......................................................................................................................................................... 43
Figure 35 Histograms of the error of the LT water temperature (truncated) ...................................... 44
Figure 36 HT temperature after the charge air cooler (data when the engine is offline has been
excluded) .......................................................................................................................................... 45
Figure 37 HT temperature after the HT/LT mixing valve (data when the engine is offline has been
excluded) .......................................................................................................................................... 45
Figure 38 LT water temperature after the seawater cooler (data when the engine is offline has been
excluded) .......................................................................................................................................... 46
Figure 39 Error of simulation data compared to validation data ........................................................ 47
Figure 40 Histograms of the error for HT water temperature after the charge air cooler (truncated) 48
Figure 41 Histograms of the error for HT water temperature after the HT/LT mixing valve (truncated)
......................................................................................................................................................... 49
Figure 42 Histograms of the error of the LT water temperature (truncated) ...................................... 50

Joachim Hammarström

61

Tables
Table 1 Heat exchanger model type comparison (Varbanov, et al., 2011) .......................................... 10
Table 2 Heat exchanger specification ................................................................................................ 15
Table 3 Comparison between Simulink and MATLAB ......................................................................... 19
Table 4 Inputs used in the engine cooling simulation ........................................................................ 26
Table 5 Mean and mean absolute errors ........................................................................................... 41
Table 6 Mean and mean absolute errors ........................................................................................... 47

Joachim Hammarström

APPENDICES
APPENDIX A
APPENDIX A.1

62

Joachim Hammarström

APPENDIX A.2

63

Joachim Hammarström

APPENDIX A.3

64

Joachim Hammarström

APPENDIX B
APPENDIX B.1

65

Joachim Hammarström

APPENDIX B.2

66

Joachim Hammarström

APPENDIX B.3

67

